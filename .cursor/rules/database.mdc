---
description: 
globs: 
alwaysApply: true
---
# Database Rules

## Архитектурные паттерны
- Repository pattern для каждого типа БД
- Dependency injection для БД подключений с @lru_cache
- Абстрактные интерфейсы (ABC) для БД операций
- Фабрики клиентов с автоматическим переключением БД
- Поддержка runtime переключения БД через конфигурацию

## Векторные базы данных
- Обязательные методы векторных репозиториев: search, upsert, delete, batch_upsert, get_by_id
- Векторные БД: Qdrant, Weaviate, Pinecone с единым интерфейсом
- Использование батчинга для загрузки эмбеддингов
- Логирование всех операций с векторной БД

## Реляционные базы данных  
- PostgreSQL: SQLAlchemy 2.0+ с async, Alembic миграции

## Кеширование
- Redis: для кеширования и сессий

## Конфигурация и подключения
- Конфигурация: легкое переключение через .env файлы
- Connection pooling для производительности
- Обработка timeout и retry для всех БД


