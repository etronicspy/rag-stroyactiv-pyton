---
description: 
globs: 
alwaysApply: true
---
# Testing Rules

## Основная стратегия тестирования
- pytest с фикстурами для каждого типа БД
- Моки для внешних БД в unit тестах
- Интеграционные тесты на реальных БД

## Functional и Integration тесты
- Functional тесты должны использовать mock-клиенты для изоляции от реальных API
- Integration тесты могут использовать реальные API при наличии рабочих ключей
- При ошибках подключения в тестах - переключаться на mock-режим
- Добавлять проверки доступности API перед запуском интеграционных тестов

## Unit тесты
- Изоляция зависимостей через моки
- Тестирование граничных случаев
- Быстрое выполнение (< 1 секунды на тест)
- Понятные названия тестов

## Тестовые данные
- Фикстуры для каждого типа БД
- Генерация тестовых данных
- Очистка данных после тестов
- Изоляция тестовых сред

## CI/CD интеграция
- Автоматический запуск тестов при коммитах
- Блокировка merge при падении тестов
- Параллельное выполнение тестов
- Отчеты о покрытии кода

## Тестирование производительности
- Load testing для критических эндпоинтов
- Stress testing для проверки границ
- Мониторинг времени отклика
- Профилирование узких мест

## Особенности тестирования БД
- Изоляция тестовых транзакций
- Rollback после каждого теста
- Тестирование миграций БД
- Проверка целостности данных
