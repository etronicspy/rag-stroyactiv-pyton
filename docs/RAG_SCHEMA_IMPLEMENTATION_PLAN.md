# üìã **–ü–õ–ê–ù –ò–ú–ü–õ–ï–ú–ï–ù–¢–ê–¶–ò–ò –°–•–ï–ú–´ RAG –°–ò–°–¢–ï–ú–´**

## üéØ **–ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø**

### **‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
1. **AI Parser Stage** - ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **RAG Normalization Stage** - ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (color/unit normalization)
3. **SKU Search Stage** - ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–∏—Å–∫)
4. **Database Save Stage** - ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (—á–µ—Ä–µ–∑ fallback manager)

### **‚ùå –ß—Ç–æ –ù–ï —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ö–µ–º–µ:**

#### **1. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π RAG Normalization**
- **–°—Ö–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç**: "–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è color, parsed_unit –ø—Ä–∏ –ø–æ–º–æ—â–∏ RAG (embedding_comparement)"
- **–°–µ–π—á–∞—Å**: –ü—Ä–æ—Å—Ç–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ exact/fuzzy matching
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è embedding comparison –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

#### **2. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SKU Assignment**
- **–°—Ö–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç**: "–ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ sku, embedding (–∏–∑: name + parsed_unit + color)"
- **–°–µ–π—á–∞—Å**: –ü–æ–∏—Å–∫ SKU —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ embedding –∏–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ name + parsed_unit + color

#### **3. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç Database Save Stage**
- **–°—Ö–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç**: "—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤"
- **–°–µ–π—á–∞—Å**: –¢–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

## üöÄ **–ü–õ–ê–ù –ò–ú–ü–õ–ï–ú–ï–ù–¢–ê–¶–ò–ò**

### **–≠–¢–ê–ü 1: –£–ª—É—á—à–µ–Ω–∏–µ RAG Normalization (2-3 –¥–Ω—è) ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

- [x] 1.1. –°–æ–∑–¥–∞–Ω–∏–µ Embedding Comparison –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- [x] 1.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Material Processing Pipeline

### **–≠–¢–ê–ü 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ SKU Assignment (2-3 –¥–Ω—è) ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

- [x] 2.1. –°–æ–∑–¥–∞–Ω–∏–µ Combined Embedding Service
- [x] 2.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SKU Search Service

### **–≠–¢–ê–ü 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Database Save Stage (1-2 –¥–Ω—è) ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

- [x] 3.1. –°–æ–∑–¥–∞–Ω–∏–µ Materials Reference Database
- [x] 3.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Pipeline

### **–≠–¢–ê–ü 4: –°–æ–∑–¥–∞–Ω–∏–µ Reference Databases (1-2 –¥–Ω—è) ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

- [x] 4.1. Colors Reference Database
- [x] 4.2. Units Reference Database
- [x] 4.3. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã–º–∏
- [x] 4.4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –ø–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º

### **–≠–¢–ê–ü 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Pipeline Models (0.5 –¥–Ω—è) ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

- [x] 5.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö (–¥–æ–±–∞–≤–ª–µ–Ω—ã normalized_color_id, normalized_unit_id, normalized_color_name, normalized_unit_name, –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è)

### **–≠–¢–ê–ü 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è (1-2 –¥–Ω—è) ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

- [x] 6.1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (–ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ–∏—Å–∫–∞ –ø–æ reference-–∫–æ–ª–ª–µ–∫—Ü–∏—è–º –∏ –ø–æ–ª–Ω–æ–≥–æ RAG pipeline)

## üéØ **–û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´**

### **–ü–æ—Å–ª–µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏:**
1. **‚úÖ RAG Normalization**: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ embedding comparison
2. **‚úÖ SKU Assignment**: –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ SKU —á–µ—Ä–µ–∑ combined embedding
3. **‚úÖ Database Save**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
4. **üü° Reference Databases**: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ —Ü–≤–µ—Ç–æ–≤ –∏ –µ–¥–∏–Ω–∏—Ü —Å embeddings (–≤ —Ä–∞–±–æ—Ç–µ)

### **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ:**
- **Input**: `id, name, unit` ‚úÖ
- **AI Parser**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `color, unit_coefficient, parsed_unit, embeddings` ‚úÖ
- **RAG Normalization**: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ embedding comparison ‚úÖ
- **SKU Assignment**: –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ SKU —á–µ—Ä–µ–∑ combined embedding ‚úÖ
- **Database Save**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚úÖ
- **Output**: `id, sku` ‚úÖ

## üö® **–ü–†–ò–û–†–ò–¢–ï–¢–´ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

### **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. **–≠–¢–ê–ü 1**: RAG Normalization —Å embedding comparison ‚úÖ
2. **–≠–¢–ê–ü 2**: SKU Assignment —Å combined embedding ‚úÖ
3. **–≠–¢–ê–ü 3**: Database Save –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚úÖ

### **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
4. **–≠–¢–ê–ü 4**: Reference databases –¥–ª—è —Ü–≤–µ—Ç–æ–≤ –∏ –µ–¥–∏–Ω–∏—Ü üü°
5. **–≠–¢–ê–ü 5**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö
6. **–≠–¢–ê–ü 6**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 6-10 –¥–Ω–µ–π**

## üìä **–î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ê–ë–û–¢**

### **–î–µ–Ω—å 1-2: –≠–¢–ê–ü 1 - RAG Normalization**
- [x] –°–æ–∑–¥–∞—Ç—å embedding comparison –º–µ—Ç–æ–¥—ã
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ pipeline
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Ü–≤–µ—Ç–æ–≤
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –µ–¥–∏–Ω–∏—Ü

### **–î–µ–Ω—å 3-4: –≠–¢–ê–ü 2 - SKU Assignment**
- [x] –û–±–Ω–æ–≤–∏—Ç—å combined embedding service
- [x] –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è SKU –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ embedding
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ pipeline
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SKU assignment

### **–î–µ–Ω—å 5: –≠–¢–ê–ü 3 - Database Save**
- [x] –°–æ–∑–¥–∞—Ç—å materials reference collection
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ pipeline
- [x] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### **–î–µ–Ω—å 6: –≠–¢–ê–ü 4 - Reference Databases**
- [ ] –°–æ–∑–¥–∞—Ç—å colors reference collection
- [ ] –°–æ–∑–¥–∞—Ç—å units reference collection
- [ ] –ù–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –ø–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º

### **–î–µ–Ω—å 7: –≠–¢–ê–ü 5-6 - Models & Testing**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π pipeline
- [ ] –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò**

### **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `core/database/collections/materials_reference.py`
- `core/database/collections/colors_reference.py`
- `core/database/collections/units_reference.py`
- `tests/integration/test_rag_pipeline.py`

### **–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- `services/embedding_comparison.py`
- `services/combined_embedding_service.py`
- `services/sku_search_service.py`
- `services/material_processing_pipeline.py`
- `core/schemas/pipeline_models.py`

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è embedding comparison
- –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è reference databases
- –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é pipeline

## üìà **–ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê**

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- [ ] 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ RAG —Å–∏—Å—Ç–µ–º—ã
- [ ] –£—Å–ø–µ—à–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ embedding comparison
- [ ] –¢–æ—á–Ω–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ SKU —á–µ—Ä–µ–∑ combined embedding
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- [ ] –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ < 5 —Å–µ–∫—É–Ω–¥
- [ ] –¢–æ—á–Ω–æ—Å—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ > 90%
- [ ] –¢–æ—á–Ω–æ—Å—Ç—å SKU assignment > 85%
- [ ] –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è > 95%

### **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- [ ] Zero breaking changes
- [ ] –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] Type safety –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ 

## üéØ **–§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°**

- –í—Å–µ —ç—Ç–∞–ø—ã –ø–ª–∞–Ω–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
- Reference-–∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ü–≤–µ—Ç–æ–≤ –∏ –µ–¥–∏–Ω–∏—Ü —Å–æ–∑–¥–∞–Ω—ã, –Ω–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ pipeline.
- Pipeline –º–æ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã, –Ω–æ–≤—ã–µ –ø–æ–ª—è –æ—Ç—Ä–∞–∂–µ–Ω—ã –≤ OpenAPI –∏ –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∏—Å–∫ –ø–æ embedding –∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

**RAG pipeline –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π —Å—Ö–µ–º–µ.** 