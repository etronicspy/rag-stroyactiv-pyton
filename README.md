# RAG Construction Materials API

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ RAG (Retrieval-Augmented Generation).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env.local` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
cp .env.example .env.local
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
python -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## üìã API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üè† –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `GET /docs` - Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `GET /openapi.json` - OpenAPI —Å—Ö–µ–º–∞

### üè• Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /api/v1/health/` - –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `GET /api/v1/health/detailed` - –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `GET /api/v1/health/databases` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### üì¶ Materials API
- `GET /api/v1/materials/` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `POST /api/v1/materials/` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª
- `GET /api/v1/materials/{id}` - –ü–æ–ª—É—á–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ ID
- `PUT /api/v1/materials/{id}` - –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
- `DELETE /api/v1/materials/{id}` - –£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
- `POST /api/v1/materials/batch` - –°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–∞–∫–µ—Ç–æ–º
- `POST /api/v1/materials/import` - –ò–º–ø–æ—Ä—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ JSON
- `POST /api/v1/materials/search` - –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `GET /api/v1/materials/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

### üí∞ Prices API
- `POST /api/v1/prices/process` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞
- `GET /api/v1/prices/{supplier_id}/latest` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `GET /api/v1/prices/{supplier_id}/all` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `DELETE /api/v1/prices/{supplier_id}` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
- `GET /api/v1/prices/{supplier_id}/pricelist/{pricelistid}` - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ ID –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞
- `PATCH /api/v1/prices/{supplier_id}/product/{product_id}/process` - –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π

### üîç Search API
- `GET /api/v1/search/` - –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `POST /api/v1/search/advanced` - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `GET /api/v1/search/suggestions` - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- `GET /api/v1/search/categories` - –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `GET /api/v1/search/units` - –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

### üìö Reference API
- `POST /api/v1/reference/categories/` - –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
- `GET /api/v1/reference/categories/` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `DELETE /api/v1/reference/categories/{category_id}` - –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ ID
- `POST /api/v1/reference/units/` - –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è
- `GET /api/v1/reference/units/` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
- `DELETE /api/v1/reference/units/{unit_id}` - –£–¥–∞–ª–∏—Ç—å –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø–æ ID

### üìä Monitoring
- `GET /api/v1/monitoring/health` - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

## üõ† –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
```bash
curl -X POST "http://localhost:8000/api/v1/materials/" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–¶–µ–º–µ–Ω—Ç –ø–æ—Ä—Ç–ª–∞–Ω–¥—Å–∫–∏–π –ú400",
    "use_category": "–¶–µ–º–µ–Ω—Ç",
    "unit": "–∫–≥",
    "description": "–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç–ª–∞–Ω–¥—Ü–µ–º–µ–Ω—Ç"
  }'
```

### –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
```bash
curl -X GET "http://localhost:8000/api/v1/search/?q=—Ü–µ–º–µ–Ω—Ç&limit=10"
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞
```bash
curl -X POST "http://localhost:8000/api/v1/prices/process" \
  -F "file=@price_list.csv" \
  -F "supplier_id=SUPPLIER_001"
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫
```bash
curl -X POST "http://localhost:8000/api/v1/search/advanced" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "—Ü–µ–º–µ–Ω—Ç",
    "search_type": "hybrid",
    "limit": 10,
    "categories": ["–¶–µ–º–µ–Ω—Ç"],
    "units": ["–∫–≥"]
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
```bash
curl "http://localhost:8000/api/v1/search/suggestions?q=—Ü–µ–º&limit=5"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
```bash
curl "http://localhost:8000/api/v1/monitoring/health"
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### üéØ –†–µ–∂–∏–º—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

#### üîß Development Mode (–¢–µ–∫—É—â–∏–π)
**Qdrant-Only —Ä–µ–∂–∏–º –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**
- **Qdrant Cloud** - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ—Å–Ω–æ–≤–Ω–∞—è)
- **Mock PostgreSQL** - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **Mock Redis** - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **OpenAI** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

#### üöÄ Production Mode (–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π)
**–ü–æ–ª–Ω–∞—è –º—É–ª—å—Ç–∏-–ë–î –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö  
- **Qdrant** - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **Redis** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- **OpenAI** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ api/routes/          # API —Ä–æ—É—Ç—ã
‚îú‚îÄ‚îÄ core/               # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/       # –ê–¥–∞–ø—Ç–µ—Ä—ã –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ middleware/     # Middleware –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
pytest
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤
```bash
# Unit —Ç–µ—Å—Ç—ã
pytest tests/unit/

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/integration/

# –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pytest tests/performance/
```

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **OpenAPI —Å—Ö–µ–º–∞**: http://localhost:8000/openapi.json

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Development Mode (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
QDRANT_URL=https://your-cluster.qdrant.tech:6333
QDRANT_API_KEY=your_qdrant_key
OPENAI_API_KEY=your_openai_key
QDRANT_ONLY_MODE=true
ENABLE_FALLBACK_DATABASES=true
```

### Production Mode (–ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–π)
```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
QDRANT_ONLY_MODE=false
DATABASE_URL=postgresql://user:pass@localhost:5432/materials
REDIS_URL=redis://localhost:6379/0
QDRANT_URL=https://your-cluster.qdrant.tech:6333
QDRANT_API_KEY=your_qdrant_key
OPENAI_API_KEY=your_openai_key
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- Health checks –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- Automatic fallback strategies

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Development (–ª–æ–∫–∞–ª—å–Ω–æ)
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
git clone <repository>
cd rag-stroyactiv-pyton
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env.local
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.local —Å –≤–∞—à–∏–º–∏ API –∫–ª—é—á–∞–º–∏

# –ó–∞–ø—É—Å–∫
python -m uvicorn main:app --reload
```

### Production
–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL –∏ Redis
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gunicorn —Å Uvicorn workers
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å reverse proxy (nginx)
- –í–∫–ª—é—á–∏—Ç—å HTTPS
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License